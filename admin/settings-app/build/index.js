(()=>{"use strict";var e={n:t=>{var s=t&&t.__esModule?()=>t.default:()=>t;return e.d(s,{a:s}),s},d:(t,s)=>{for(var n in s)e.o(s,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:s[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.element,s=window.wp.i18n,n=window.wp.components,a=window.wp.apiFetch;var o=e.n(a);const i=window.wp.url,r=(e,t)=>{let n=Object.assign({},e);switch(t.type){case"FETCH_SETTINGS":n.fetchedSettings=t.payload.fetchedSettings.data,n.stateSettings=t.payload.stateSettings.data,n.isPending=!1,n.canSave=!1,void 0!==t.payload.fetchedSettings.renew_count_errors&&(n.notice=(0,s.__)("An error occurred.","woo-subs-ren-count"),n.hasError=!0);break;case"UPDATE_CUSTOM_FIELD_BEFORE":n.isPending=t.payload.isPending,n.newSubscriptions={},n.stateSubscriptions={},n.fetchedSettings={},n.stateSettings={},n.hasError=!1;break;case"UPDATE_CUSTOM_FIELD":n.fetchedSubscriptions=t.payload.updatedSettings.data?.subscriptions,n.stateSubscriptions=t.payload.updatedSettings.data?.subscriptions,n.fetchedSettings=t.payload.updatedSettings.data?.settings,n.stateSettings=t.payload.updatedSettings.data?.settings,n.isPending=!1,n.canSave=!1,void 0!==t.payload.updatedSettings.update_errors&&(n.notice=(0,s.__)("An error occurred.","woo-subs-ren-count"),n.hasError=!0),!1===t.payload.updatedSettings.success&&(n.notice=t.payload.updatedSettings.message,n.hasError=!0);break;case"UPDATE_STATE":t.payload.fetchedSettings&&(n.fetchedSettings=t.payload.fetchedSettings),t.payload.stateSettings&&(n.stateSettings=t.payload.stateSettings),void 0!==t.payload.isPending&&(n.isPending=t.payload.isPending),void 0!==t.payload.notice&&(n.notice=t.payload.notice),void 0!==t.payload.hasError&&(n.hasError=t.payload.hasError),void 0!==t.payload.canSave&&(n.canSave=t.payload.canSave)}return n},d=window.ReactJSXRuntime,c=(0,t.createContext)(),u=e=>{const[s,n]=(0,t.useReducer)(r,{fetchedSettings:{},stateSettings:{},fetchedSubscriptions:{},stateSubscriptions:{},isPending:!1,notice:"",hasError:"",canSave:!1}),a=async()=>{const e=await(async()=>{let e={};try{e=await o()({path:"renewcountwoo/v1/getsettings",method:"GET",headers:{"X-WP-Nonce":renew_count_js_data?.rest_nonce}})}catch(e){return console.log("fetchSettings Errors:",e),{renew_count_errors:!0}}return e})();n({type:"FETCH_SETTINGS",payload:{fetchedSettings:e,stateSettings:e}})};(0,t.useEffect)((()=>{a()}),[]);let u={useDispatch:e=>{n(e)},useFetchSettings:a,useUpdateState:async e=>{n({type:"UPDATE_STATE",payload:e})},useUpdateCustomField:async e=>{n({type:"UPDATE_CUSTOM_FIELD_BEFORE",payload:{isPending:!0}});const t=await(async e=>{let t="renewcountwoo/v1/updatecustomfieldname",s=[],n={field_name:e?.field_name};t=(0,i.addQueryArgs)(t,n);try{s=await o()({path:t,method:"POST",headers:{"X-WP-Nonce":renew_count_js_data?.rest_nonce}})}catch(e){return console.log("updateCustomField Errors:",e),{update_errors:!0}}return s})(e);n({type:"UPDATE_CUSTOM_FIELD",payload:{updatedSettings:t}})},useSettings:s.stateSettings,useSubscriptions:s.stateSubscriptions,useIsPending:s.isPending,useNotice:s.notice,useHasError:s.hasError,useCanSave:s.canSave};return(0,d.jsx)(c.Provider,{value:u,children:e.children})},p=()=>{const{useSettings:e,useIsPending:a,useUpdateCustomField:o,useSubscriptions:i,useHasError:r,useNotice:u}=(0,t.useContext)(c),[p,l]=(0,t.useState)("");return(0,t.useEffect)((()=>{e&&l(e.custom_field_name)}),[e]),Object.keys(e).length||!1!==a?(0,d.jsxs)("div",{children:[(0,d.jsx)("h1",{children:(0,s.__)("Subscription Renewal Count Custom Field Settings","woo-subs-ren-count")}),(0,d.jsxs)("div",{style:{maxWidth:"600px",marginTop:"20px"},children:[r&&(0,d.jsx)("div",{style:{marginBottom:"20px"},children:(0,d.jsx)(n.Notice,{status:"error",children:u})}),(0,d.jsx)(n.TextControl,{label:(0,s.__)("Custom Field Name","woo-subs-ren-count"),value:p,onChange:e=>l(e),help:(0,s.__)("All subsciptions will be updated when you change the field name.","woo-subs-ren-count")}),(0,d.jsxs)(n.Button,{variant:"primary",onClick:()=>o({field_name:p}),disabled:e&&e.custom_field_name===p,children:[(0,d.jsx)("span",{children:(0,s.__)("Save & Update Subscriptions","woo-subs-ren-count")}),a&&(0,d.jsx)(n.Spinner,{})]})]})]}):(0,d.jsxs)("div",{children:[(0,d.jsx)("h1",{children:(0,s.__)("Subscription Renewal Count Custom Field Settings","woo-subs-ren-count")}),(0,d.jsx)(n.Spinner,{})]})},l=()=>(0,d.jsx)(u,{children:(0,d.jsx)(p,{})}),S=document.getElementById("subs_renew_count_wrapper");S&&document.addEventListener("DOMContentLoaded",(()=>{(0,t.createRoot)(S).render((0,d.jsx)(l,{}))}))})();